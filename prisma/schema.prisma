generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String        @id @default(cuid())
  name           String?
  email          String?       @unique
  emailVerified  DateTime?
  image          String?
  password       String?
  role           Role          @default(USER)
  subscriptionId String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
  deletedAt      DateTime?
  accounts       Account[]
  categories     Category[]
  transactions   Transaction[]
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])
  wallets        Wallet[]
}

model Account {
  id           String        @id @default(cuid())
  userId       String
  name         String
  currency     String        @default("IDR")
  balance      Decimal       @default(0) @db.Decimal(15, 2)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  deletedAt    DateTime?
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
  wallets      Wallet[]
}

model Subscription {
  id                 String             @id @default(cuid())
  subscriptionStatus SubscriptionStatus @default(PRO)
  approvalStatus     ApprovalStatus     @default(ACTIVE)
  subscriptionStart  DateTime?
  subscriptionEnd    DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @default(now()) @updatedAt
  deletedAt          DateTime?
  users              User[]
}

model Wallet {
  id               String        @id @default(cuid())
  accountId        String
  userId           String
  name             String
  balance          Decimal       @default(0) @db.Decimal(15, 2)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @default(now()) @updatedAt
  deletedAt        DateTime?
  transactionsTo   Transaction[] @relation("toWallet")
  transactionsFrom Transaction[] @relation("fromWallet")
  account          Account       @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Category {
  id           String        @id @default(cuid())
  userId       String
  name         String
  type         CategoryType
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  deletedAt    DateTime?
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
}

model Transaction {
  id          String          @id @default(cuid())
  accountId   String
  walletId    String
  toAccountId String?
  toWalletId  String?
  categoryId  String
  userId      String
  amount      Decimal         @db.Decimal(10, 2)
  type        TransactionType
  note        String?
  date        DateTime
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @default(now()) @updatedAt
  deletedAt   DateTime?
  account     Account         @relation(fields: [accountId], references: [id], onDelete: Cascade)
  category    Category        @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  toWallet    Wallet?         @relation("toWallet", fields: [toWalletId], references: [id], onDelete: Cascade)
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  wallet      Wallet          @relation("fromWallet", fields: [walletId], references: [id], onDelete: Cascade)
  // Admin fee fields
  parentId       String?         @db.Text
  parent         Transaction?    @relation("AdminFeeRelation", fields: [parentId], references: [id], onDelete: Cascade)
  isAdminFee     Boolean         @default(false)
  adminFeeAmount Decimal?        @db.Decimal(10, 2)
  adminFeeChild  Transaction[]   @relation("AdminFeeRelation")
}

enum Role {
  ADMIN
  USER
}

enum CategoryType {
  income
  expense
  transfer
}

enum TransactionType {
  income
  expense
  transfer
}

enum SubscriptionStatus {
  FREE
  PRO
}

enum ApprovalStatus {
  PENDING
  ACTIVE
  EXPIRED
  REJECTED
}
