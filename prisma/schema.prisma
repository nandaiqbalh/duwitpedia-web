// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ===========================
// ENUMS
// ===========================
enum Role {
  ADMIN
  USER
}

enum CategoryType {
  income
  expense
  transfer
}

enum TransactionType {
  income
  expense
  transfer
}

enum SubscriptionStatus {
  FREE
  PRO
}

enum ApprovalStatus {
  PENDING
  ACTIVE
  EXPIRED
  REJECTED
}


// ===========================
// NEXTAUTH MODELS
// ===========================

model User {
  id              String           @id @default(cuid())
  name            String?
  email           String?          @unique
  emailVerified   DateTime?
  image           String?
  password        String?          // For email/password authentication
  role            Role             @default(USER)
  subscriptionId  String?
  
  subscription    Subscription?    @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)

  // For Duwitpedia app
  accounts        Account[]
  wallets         Wallet[]
  categories      Category[]
  transactions    Transaction[]

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt @default(now())
  deletedAt       DateTime?
}

model Account {
  id          String          @id @default(cuid())
  userId      String
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  currency    String          @default("IDR")
  balance     Decimal         @default(0) @db.Decimal(15, 2)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt @default(now())
  deletedAt   DateTime?

  wallets      Wallet[]
  transactions Transaction[]
}

model Subscription {
  id                String           @id @default(cuid())
  users             User[]

  subscriptionStatus SubscriptionStatus @default(PRO)
  approvalStatus     ApprovalStatus     @default(ACTIVE)
  
  subscriptionStart  DateTime?
  subscriptionEnd    DateTime?
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt @default(now())
  deletedAt         DateTime?
}


// ===========================
// DUWITPEDIA MODELS
// ===========================

model Wallet {
  id          String        @id @default(cuid())
  accountId   String
  userId      String
  
  account     Account       @relation(fields: [accountId], references: [id], onDelete: Cascade)
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  balance     Decimal       @default(0) @db.Decimal(15, 2)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt @default(now())
  deletedAt   DateTime?

  transactionsFrom Transaction[] @relation("fromWallet")
  transactionsTo   Transaction[] @relation("toWallet")
}

model Category {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  type        CategoryType
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt @default(now())
  deletedAt   DateTime?

  transactions Transaction[]
}

model Transaction {
  id          String           @id @default(cuid())
  accountId   String
  walletId    String
  toAccountId String?
  toWalletId  String?
  categoryId  String
  userId      String

  account     Account          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  wallet      Wallet           @relation(fields: [walletId], references: [id], onDelete: Cascade, name: "fromWallet")
  toWallet    Wallet?          @relation(fields: [toWalletId], references: [id], onDelete: Cascade, name: "toWallet")
  category    Category         @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  amount      Decimal          @db.Decimal(10, 2)
  type        TransactionType
  note        String?
  date        DateTime
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt @default(now())
  deletedAt   DateTime?
}
